<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Админ-панель</title>
    <!-- Bootstrap 5 -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- FontAwesome -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css" rel="stylesheet">
    <!-- SweetAlert2 -->
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <style>
        body {background: #f8f9fa;}
        .sidebar {min-height: 100vh; background: #343a40; color: #fff;}
        .sidebar a {color: #fff; text-decoration: none;}
        .sidebar a.active {background: #495057; border-radius: 0.375rem;}
        .table thead {background: #e9ecef;}
    </style>
</head>
<body>

<div class="d-flex">
    <!-- Sidebar -->
    <div class="sidebar p-3">
        <h4 class="mb-4">Панель</h4>
        <ul class="nav flex-column">
            <li class="nav-item mb-2"><a href="#" class="nav-link active" onclick="loadUsersContent()"><i class="fas fa-users me-2"></i>Пользователи</a></li>
            <li class="nav-item mb-2"><a href="#" class="nav-link" onclick="loadPromoCodesContent()"><i class="fas fa-gift me-2"></i>Промокоды</a></li>
            <li class="nav-item mb-2"><a href="#" class="nav-link" onclick="loadTransactionsContent()"><i class="fas fa-exchange-alt me-2"></i>Транзакции</a></li>
            <li class="nav-item mb-2"><a href="#" class="nav-link" onclick="loadSettingsContent()"><i class="fas fa-cog me-2"></i>Настройки</a></li>
            <li class="nav-item mb-2"><a href="#" class="nav-link" onclick="loadApiContent()"><i class="fas fa-code me-2"></i>API</a></li>
            <li class="nav-item mb-2"><a href="#" class="nav-link" onclick="showBroadcastModal()"><i class="fas fa-bullhorn me-2"></i>Массовая рассылка</a></li>
        </ul>
    </div>

    <!-- Main content -->
    <div class="flex-grow-1 p-4" id="page-content">
        <h5>Добро пожаловать в админ-панель</h5>
        <p>Выберите раздел слева для управления системой.</p>
    </div>
</div>

<!-- Modal container -->
<div id="modalContainer" class="modal fade" tabindex="-1"></div>

<!-- Bootstrap JS -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
<script src="https://code.jquery.com/jquery-3.7.0.min.js"></script>

<script>
const CONFIG = {
    BOT_TOKEN: 'ВАШ_ТОКЕН_БОТА',
    BACKEND_URL: 'https://ваш-бэкенд.com'
};

// =============== УВЕДОМЛЕНИЯ ===============
function showNotification(type, title, text) {
    Swal.fire({icon: type, title: title, text: text, timer: 2000, toast: true, position: 'top-end', showConfirmButton: false});
}

// =============== ПОЛЬЗОВАТЕЛИ ===============
function loadUsersContent() {
    $('#page-content').html('<div class="text-center py-5"><div class="spinner-border"></div> Загрузка...</div>');
    setTimeout(() => {
        $('#page-content').html(`<div class="card">
            <div class="card-header"><h5><i class="fas fa-users me-2"></i>Пользователи</h5></div>
            <div class="card-body">
                <table class="table table-hover"><thead><tr><th>ID</th><th>Telegram</th><th>Имя</th><th>Баланс</th><th>Дата</th></tr></thead>
                <tbody id="usersTableBody"></tbody></table>
            </div>
        </div>`);
        const users = [{id:1, telegram_id:123, username:'ivan', first_name:'Иван', balance:100, created_at:'2024-01-01'}];
        let html = '';
        users.forEach(u=>{html+=`<tr><td>${u.id}</td><td>${u.username}</td><td>${u.first_name}</td><td>$${u.balance}</td><td>${u.created_at}</td></tr>`});
        $('#usersTableBody').html(html);
    },500);
}

// =============== ПРОМОКОДЫ ===============
function loadPromoCodesContent(){
    $('#page-content').html('<div class="text-center py-5"><div class="spinner-border"></div> Загрузка промокодов...</div>');
    setTimeout(()=>{
        let codes = JSON.parse(localStorage.getItem('promo_codes')||'[]');
        let html='';
        if(codes.length){
            codes.forEach(c=>{html+=`<tr><td>${c.code}</td><td>$${c.amount}</td><td>${c.is_used?"Использован":"Активен"}</td><td>${c.created_at}</td><td><button class='btn btn-sm btn-danger' onclick="deletePromoCode('${c.code}')"><i class='fas fa-trash'></i></button></td></tr>`});
        } else html=`<tr><td colspan='5' class='text-center py-5'>Нет промокодов</td></tr>`;
        $('#page-content').html(`<div class='card'><div class='card-header'><h5><i class='fas fa-gift me-2'></i>Промокоды</h5><button class='btn btn-primary btn-sm float-end' onclick='showGenerateCodesModal()'>Создать</button></div><div class='card-body'><table class='table table-hover'><thead><tr><th>Код</th><th>Сумма</th><th>Статус</th><th>Дата</th><th>Действия</th></tr></thead><tbody>${html}</tbody></table></div></div>`);
},500)}
function deletePromoCode(code){
    Swal.fire({title:'Удалить промокод?', text:code, icon:'warning',showCancelButton:true, confirmButtonText:'Да'}).then(r=>{if(r.isConfirmed){
        let codes=JSON.parse(localStorage.getItem('promo_codes')||'[]');
        codes=codes.filter(c=>c.code!==code);
        localStorage.setItem('promo_codes',JSON.stringify(codes));
        showNotification('success','Удалено',code);
        loadPromoCodesContent();
    }});
}
function showGenerateCodesModal(){
    $('#modalContainer').html(`<div class='modal-dialog'><div class='modal-content'><div class='modal-header'><h5>Создать промокоды</h5><button type='button' class='btn-close' data-bs-dismiss='modal'></button></div><div class='modal-body'><input type='number' id='codeCount' value='5' class='form-control'><input type='number' id='codeAmount' value='10' class='form-control mt-2'></div><div class='modal-footer'><button class='btn btn-secondary' data-bs-dismiss='modal'>Отмена</button><button class='btn btn-primary' onclick='generateNewCodes()'>Создать</button></div></div></div>`);
    new bootstrap.Modal(document.getElementById('modalContainer')).show();
}
function generateNewCodes(){
    const count=parseInt($('#codeCount').val()), amount=parseFloat($('#codeAmount').val());
    let codes=JSON.parse(localStorage.getItem('promo_codes')||'[]');
    for(let i=0;i<count;i++){let code='PROMO'+Math.random().toString(36).substr(2,6).toUpperCase(); codes.push({code,amount,is_used:false,created_at:new Date().toLocaleDateString()});}
    localStorage.setItem('promo_codes',JSON.stringify(codes));
    showNotification('success','Создано',`${count} кодов`);
    loadPromoCodesContent();
    bootstrap.Modal.getInstance(document.getElementById('modalContainer')).hide();
}

// ================= ТРАНЗАКЦИИ =================
function loadTransactionsContent(){
    $('#page-content').html('<div class="text-center py-5"><div class="spinner-border"></div> Загрузка транзакций...</div>');
    setTimeout(()=>{
        const transactions=[{id:1,user_name:'Иван',amount:100,type:'deposit',date:'2024-01-01',description:'Пополнение',admin:'System'}];
        let html='';
        transactions.forEach(t=>{let cls=t.amount>0?'text-success':'text-danger'; html+=`<tr><td>${t.id}</td><td>${t.user_name}</td><td>${t.type}</td><td class='${cls}'>${t.amount}</td><td>${t.date}</td><td>${t.description}</td><td>${t.admin}</td></tr>`});
        $('#page-content').html(`<div class='card'><div class='card-header'><h5>Транзакции</h5></div><div class='card-body'><table class='table table-hover'><thead><tr><th>ID</th><th>Пользователь</th><th>Тип</th><th>Сумма</th><th>Дата</th><th>Описание</th><th>Админ</th></tr></thead><tbody>${html}</tbody></table></div></div>`);
    },500);
}

// ================= НАСТРОЙКИ =================
function loadSettingsContent(){
    $('#page-content').html(`<div class='card'><div class='card-header'><h5>Настройки</h5></div><div class='card-body'>
    <div class='mb-3'><label>Минимальный вывод</label><input id='minWithdrawal' type='number' class='form-control' value='50'></div>
    <div class='mb-3'><label>Реферальный бонус</label><input id='referralBonus' type='number' class='form-control' value='10'></div>
    <button class='btn btn-primary' onclick='saveSettings()'>Сохранить</button>
</div></div>`);
}
function saveSettings(){
    const s={minWithdrawal:$('#minWithdrawal').val(),referralBonus:$('#referralBonus').val()};
    localStorage.setItem('bot_settings',JSON.stringify(s));
    showNotification('success','Сохранено','Настройки обновлены');
}

// ================= API =================
function loadApiContent(){
    $('#page-content').html(`<div class='card'><div class='card-header'><h5>API</h5></div><div class='card-body'><pre>${CONFIG.BACKEND_URL}/api/</pre></div></div>`);
}

// ================= РАССЫЛКА =================
function showBroadcastModal(){
    $('#modalContainer').html(`<div class='modal-dialog'><div class='modal-content'><div class='modal-header'><h5>Массовая рассылка</h5><button class='btn-close' data-bs-dismiss='modal'></button></div>
    <div class='modal-body'><textarea id='broadcastText' class='form-control' rows='5'></textarea></div>
    <div class='modal-footer'><button class='btn btn-secondary' data-bs-dismiss='modal'>Отмена</button><button class='btn btn-primary' onclick='sendBroadcast()'>Отправить</button></div>
</div></div>`);
    new bootstrap.Modal(document.getElementById('modalContainer')).show();
}
function sendBroadcast(){
    const t=$('#broadcastText').val(); if(!t){showNotification('error','Ошибка','Введите текст'); return;}
    showNotification('success','Рассылка','Отправлено');
    bootstrap.Modal.getInstance(document.getElementById('modalContainer')).hide();
}

// Загрузка по умолчанию
loadUsersContent();
</script>
</body>
</html>
